services:
  backend:
    build:
      context: .
    restart: always
    ports:
      - "443:443"
    environment:
      PORT: "443"
      SSL_DIR: /app/data/ssl
      SSL_CERT_PATH: /app/data/ssl/cert.pem
      SSL_KEY_PATH: /app/data/ssl/key.pem
      LE_ENABLED: "true"
      LE_EMAIL: "lorenzo.contessa02@gmail.com"
      LE_DOMAINS: "widlifespotter.app,*.widlifespotter.app"
      CLOUDFLARE_API_TOKEN: "${CLOUDFLARE_API_TOKEN:-}"
      LE_DIR: /app/data/letsencrypt
      ANIMALDETECT_API_KEY: "${ANIMALDETECT_API_KEY:-}"
      DB_HOST: "mysql"
      DB_PORT: "3306"
      DB_NAME: "wildlife_spotter"
      DB_USER: "wildlife"
      DB_PASSWORD: "wildlife"
    volumes:
      - /opt/data:/app/data
    depends_on:
      - mysql
  certbot:
    build:
      context: .
    restart: always
    environment:
      LE_ENABLED: "true"
      LE_EMAIL: "lorenzo.contessa02@gmail.com"
      LE_DOMAINS: "widlifespotter.app,*.widlifespotter.app"
      CLOUDFLARE_API_TOKEN: "${CLOUDFLARE_API_TOKEN:-}"
      LE_DIR: /app/data/letsencrypt
    volumes:
      - /opt/data:/app/data
    command: ["/app/letsencrypt-renew.sh"]
  mysql:
    image: mysql:latest
    restart: always
    environment:
      MYSQL_DATABASE: "wildlife_spotter"
      MYSQL_USER: "wildlife"
      MYSQL_PASSWORD: "wildlife"
      MYSQL_ROOT_PASSWORD: "Wj1YEb@fbMJ2tCn4MJRRq"
    volumes:
      - mysql_data:/var/lib/mysql
  phpmyadmin:
    image: phpmyadmin:latest
    restart: always
    environment:
      PMA_HOST: "mysql"
      PMA_PORT: "3306"
    ports:
      - "8080:80"
    depends_on:
      - mysql

volumes:
  mysql_data:
